language: cpp

sudo: false

matrix:
  include:
    - os: osx
      osx_image: xcode9.4

    - os: osx
      osx_image: xcode10.2

before_install:
  - brew tap nlohmann/json
  - TAPS_DIR=$(brew --prefix)/Homebrew/Library/Taps
  - mkdir $TAPS_DIR/decentfoundation
  - ln -s $(pwd) $TAPS_DIR/decentfoundation/homebrew-dcore

script:
  # ignore 'Dependency nlohmann/json/nlohmann_json should not use option with-cmake'
  - brew audit --except-cops=FormulaAudit/Miscellaneous dcore
  - brew install --build-bottle --verbose dcore
  - brew bottle --root-url=https://dl.bintray.com/decentfoundation/homebrew --skip-relocation dcore
  - DCORE_VERSION=$(brew list --versions dcore | sed 's/.* //')
  - sed "s/VERSION/$DCORE_VERSION/" .bintray.json > descriptor.json

deploy:
  skip_cleanup: true
  provider: bintray
  file: descriptor.json
  user: decent-dcore
  key:
    secure: DW33pI6H86X9AWpcSh22LRL4JNLo3rpujdREC3KHxN62AzeVSxf/oBcgqIWBQ8mT7FMPfp4O99RrHqYB2PtRLgfWwutP754UBjhCRLJqng2M+O8uF7tna2nh5eEgMUH8NfjLtdh6aA9K6sdM2IEAUQvBjffLGnAECKRe2z9+ZCjQoG4RcwyB3dlRJX9PWwkZpnbDcyv5E1zZmkSD5ezKRA8KqOfOcBXem0y7bEt2S3o1cTOUoIq8wiHJM+5Sy9Jj17KgymNpXRt62uW68Kai4xKiCvCixg6TzIMq7nvnSCJpb5+X4VlA65FOTLTrbh5UYjnBl8V+eV4BaRpZakn7ot+zHUQzl27JNfCTJto2HyGSjuNLzDDNSIqWLPf5VN4elRbVB7vLSwbwXejX+GMZzJw3CdRTRYqdbrXfPsuA1w6BeS/hCa0rZubDy0Q+DDlaUckHvuAhdcCEZHtOgRfK5JNccqKRgvF6gR9QOpg6Yo3xwagpy0H5ylNkCvYndzVd8u+51edTCsK4WzqSF+K7ZZ5PxZPDuYoY1NkpemWwiJlzAnf6p1d/pAyqmWxqtaAYK/XgpAReP+cwWLTTK7Vxbp6X0wRnnT1wa0ZIGAgbnv2K0t5FtMDPfXiAX/1jYv0LhCWzW7cxZoeMYu7iBogMjL6i82xq7cNJsc1ZvaiYF20=
  on:
    tags: true

notifications:
  email:
    on_success: never
    on_failure: always
